--Họ tên: Vương Đinh Thanh Ngân--
--Lớp: IT004.M12--
--MSSV: 20521649--
--Kỳ thi cuối học kỳ thực hành môn Cơ Sơ Dữ Liệu--
DROP DATABASE QLNV
CREATE DATABASE QLNV
USE QLNV
--INPUT:
--OUTPUT:

--CÂU 1:Viết các câu lệnh SQL tạo các quan hệ trên với các kiểu dữ liệu trong bảng mô tả--
--INPUT: Bảng mô tả
--OUTPUT: Các quan hệ trong SQL--

CREATE TABLE NHANVIEN
(
	MANV CHAR(4),
	HOTEN NVARCHAR(50),
	NGSINH SMALLDATETIME,
	DCHI NVARCHAR(50),
	GTINH CHAR(4),
	LUONG MONEY,
	MAPHG CHAR(5),
	PRIMARY KEY (MANV) 
)


CREATE TABLE PHONGBAN
(
	MAPHG CHAR(5),
	TENPHG NVARCHAR(50),
	NGTL SMALLDATETIME
	PRIMARY KEY (MAPHG)
)

CREATE TABLE NHANSU
(
	MANV CHAR(4),
	MAPHG CHAR(5),
	CHUCVU CHAR(4),
	NGVL SMALLDATETIME,
	PRIMARY KEY (MANV, MAPHG)
)

CREATE TABLE DEAN
(
	MADA CHAR(10),
	MAPHG CHAR(5),
	TENDA NVARCHAR(100),
	NGBD SMALLDATETIME,
	NGAYKT SMALLDATETIME,
	PRIMARY KEY (MADA)
)

CREATE TABLE PHANCONG
(
	MANV CHAR(4),
	MADA CHAR(10),
	THOIGIAN SMALLDATETIME,
	PRIMARY KEY (MADA, MANV)
)
--CÂU 2: TẠO CÁC RÀNG BUỘC--
--INPUT: KHOÁ NGOẠI, CÁC BẢNG
--OUTPUT: CÁC RÀNG BUỘC CỦA KHOÁ NGOẠI
ALTER TABLE NHANSU
ADD CONSTRAINT FK_NHANSU_KHOA FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE NHANVIEN 
ADD CONSTRAINT FK_NHANVIEN_PHONGBAN FOREIGN KEY (MAPHG) REFERENCES PHONGBAN(MAPHG)

ALTER TABLE NHANSU
ADD CONSTRAINT FK_NHANSU_PHONGBAN FOREIGN KEY (MAPHG) REFERENCES PHONGBAN(MAPHG)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_NHANVIEN_PHANCONG FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_DEAN_PHANCONG FOREIGN KEY (MADA) REFERENCES DEAN(MADA)

ALTER TABLE DEAN
ADD CONSTRAINT FK_PHONGBAN_DEAN FOREIGN KEY (MAPHG) REFERENCES PHONGBAN(MAPHG)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_NHANSU_PHANCONG FOREIGN KEY (MANV) REFERENCES NHANSU(MANV)
--CÂU 3: MỖI QUAN HỆ THÊM MỘT RANG BUỘC-- 
--INPUT: CÁC QUAN HỆ
--OUTPUT: CÁC RÀNG BUỘC CHO CÁC QUAN HỆ
ALTER TABLE NHANVIEN
ADD CONSTRAINT CK_GTINH CHECK(GTINH IN ('Nam', 'Nữ'))

ALTER TABLE PHONGBAN
ADD CONSTRAINT CK_NAM CHECK(YEAR(NGTL) > 2000)

ALTER TABLE NHANSU
ADD CONSTRAINT CK_NGVL CHECK(YEAR(NGVL) > 2005)

ALTER TABLE DEAN
ADD CONSTRAINT CK_NGAYKT CHECK(YEAR(NGAYKT) BETWEEN 2018 AND 2021)

ALTER TABLE PHANCONG
ADD CONSTRAINT CK_THOIGIAN CHECK(THOIGIAN > 0)

--CÂU 4: CẬP NHẬT DỮ LIỆU--

INSERT INTO PHONGBAN(MAPHG, TENPHG, NGTL) VALUES ('001', N'Phòng Tổ chức Cán bộ', '8/6/2005')
INSERT INTO PHONGBAN(MAPHG, TENPHG, NGTL) VALUES ('002', N'Phòng Hành Chính', '18/1/2006')
INSERT INTO PHONGBAN(MAPHG, TENPHG, NGTL) VALUES ('003', N'Phòng Tài Chính', '27/9/2007')
INSERT INTO PHONGBAN(MAPHG, TENPHG, NGTL) VALUES ('004', N'Phòng Khoa học Công nghệ', '20/5/2008')
INSERT INTO PHONGBAN(MAPHG, TENPHG, NGTL) VALUES ('005', N'Phòng Quản trị', '15/9/2009')

INSERT INTO NHANVIEN(MANV, HOTEN, NGSINH, DCHI, GTINH, LUONG, MAPHG) VALUES ('N001', N'Phạm Thanh Long', '8/6/2000', 'Cà Mau', 'Nam', 9000000, '001')
INSERT INTO NHANVIEN(MANV, HOTEN, NGSINH, DCHI, GTINH, LUONG, MAPHG) VALUES ('N002', N'Nguyễn Thanh Thanh', '18/3/2001', 'Bạc Liêu', 'Nữ', 8000000, '002')
INSERT INTO NHANVIEN(MANV, HOTEN, NGSINH, DCHI, GTINH, LUONG, MAPHG) VALUES ('N003', N'Võ Ngọc Thành', '28/7/2002', 'An Giang', 'Nam', 5000000, '003')
INSERT INTO NHANVIEN(MANV, HOTEN, NGSINH, DCHI, GTINH, LUONG, MAPHG) VALUES ('N004', N'Nguyễn Thị Hoa', '26/9/2001', 'Long An', 'Nữ', 9500000, '004')
INSERT INTO NHANVIEN(MANV, HOTEN, NGSINH, DCHI, GTINH, LUONG, MAPHG) VALUES ('N005', N'Lâm Thị Huệ', '13/1/2000', 'Tp.HCM', 'Nữ', 7500000, '005')

INSERT INTO NHANSU(MANV, MAPHG, CHUCVU, NGVL) VALUES('N001', '001', 'GĐ', '15/9/2010')
INSERT INTO NHANSU(MANV, MAPHG, CHUCVU, NGVL) VALUES('N002', '002', 'QL', '20/4/2011')
INSERT INTO NHANSU(MANV, MAPHG, CHUCVU, NGVL) VALUES('N003', '003', 'TP', '12/6/2012')

INSERT INTO DEAN(MADA, MAPHG, TENDA, NGBD, NGAYKT) VALUES('DA001', '001', N'Quản Lý Tàu', '15/1/2020', '15/9/2020')
INSERT INTO DEAN(MADA, MAPHG, TENDA, NGBD, NGAYKT) VALUES('DA002', '002', N'Quản Lý Giao Thông', '10/2/2020', '18/8/2020')
INSERT INTO DEAN(MADA, MAPHG, TENDA, NGBD, NGAYKT) VALUES('DA003', '003', N'Xây dựng Trại', '11/3/2020', '11/5/2020')

INSERT INTO PHANCONG(MANV, MADA, THOIGIAN) VALUES('N003', 'DA003', '15/1/2020')
INSERT INTO PHANCONG(MANV, MADA, THOIGIAN) VALUES('N002', 'DA003', '15/2/2020')
INSERT INTO PHANCONG(MANV, MADA, THOIGIAN) VALUES('N004', 'DA001', '16/3/2020')
INSERT INTO PHANCONG(MANV, MADA, THOIGIAN) VALUES('N005', 'DA002', '15/2/2020')
INSERT INTO PHANCONG(MANV, MADA, THOIGIAN) VALUES('N001', 'DA003', '15/1/2020')

--CÂU 5: --
--INPUT: BẢNG NHÂN VIÊN, ĐỀ ÁN
--OUTPUT: CÁC NHÂN VIÊN THAM GIA DA001 VÀ DA003--
SELECT MANV, HOTEN, NGSINH
FROM NHANVIEN, DEAN
WHERE MADA IN ( 'DA001', 'DA002')

--CÂU 6: --
--INPUT: BẢNG NHÂN VIÊN, PHONGBAN
-- OUTPUT: NHÂN VIÊN PHÒNG BANG 003 LÀM SAU NGÀY 01/01/2010--
SELECT NHANVIEN.MANV, HOTEN, NGSINH
FROM NHANSU, NHANVIEN
WHERE NHANVIEN.MAPHG = '003' AND NGVL > '01/01/2010'


--CÂU 7: --
--INPUT: BẢNG PHÒNG BAN
--OUTPUT: PHÒNG BAN CÓ SỐ LƯƠNG ÍT NHẤT
SELECT COUNT(MANV) AS SL
FROM PHONGBAN
WHERE MAPHG (SELECT 

--CÂU 8: --
--CÂU 9: --
--CÂU 10: --


--INPUT:
--OUTPUT: